services:
  # PostgreSQL Database
  - type: postgres
    name: axiomos-db
    plan: starter
    databaseName: axiomos
    user: axiomos_user
    
  # Redis Cache
  - type: redis
    name: axiomos-redis
    plan: starter
    
  # Web Service - AxiomOS with Frontend
  - type: web
    name: axiomos-web
    env: python
    runtime: uv
    plan: starter
    buildCommand: "uv sync --frozen && uv cache prune --ci"
    startCommand: "uv run python fastapi_app.py"
    healthCheckPath: /health
    
    # Environment variables (auto-connected to services)
    envVars:
      - key: PYTHON_VERSION
        value: 3.13.0
      - key: UV_LOCK_VERSION
        value: "1"
      - key: GROQ_API_KEY
        sync: false
      - key: GROQ_MODEL
        value: llama-3.1-8b-instant
      - key: GROQ_MAX_TOKENS
        value: "1000"
      - key: GROQ_TEMPERATURE
        value: "0.7"
      
      # PostgreSQL - Auto-connected to axiomos-db
      - key: DB_HOST
        fromDatabase:
          name: axiomos-db
          property: host
      - key: DB_PORT
        value: "5432"
      - key: DB_NAME
        fromDatabase:
          name: axiomos-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: axiomos-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: axiomos-db
          property: password
      
      # Redis - Auto-connected to axiomos-redis
      - key: REDIS_HOST
        fromService:
          type: redis
          name: axiomos-redis
          property: host
      - key: REDIS_PORT
        value: "6379"
      - key: REDIS_DB
        value: "0"
      - key: REDIS_PASSWORD
        fromService:
          type: redis
          name: axiomos-redis
          property: password
      
      # Production settings
      - key: SESSION_TIMEOUT
        value: "3600"
      - key: LOG_LEVEL
        value: INFO